05/07 - 05/13

需求分析（功能模块）  
1.用户登录
2.用户注册
3.显示在线用户列表
4.群聊（广播）
5.点对点聊天
6.离线留言

**注：这是一个简易即时聊天demo。**
go + redis实现

系统实现
采用MVC分层结构


#######用户登录功能实现#
1.客户端向服务器发送登录信息，其中分为两步骤过程实现
操作步骤：
1.1.先向服务器发送登录信息的长度
1.2.再向服务器发送登录信息的本体

2.服务器根据客户端发送的消息，判断用户的合法性，并返回相应的LoginResMes
操作步骤：
2.1.让客户端发送消息本身
2.2.服务器接收到消息，然后反序列化为对应的消息结构体
2.3.服务器根据反序列化成对应的消息，判断登录用户是否合法，返回LoginResMes
2.4.客户端解析返回的LoginResMes,显示对应界面

**注：在客户端用户成功登录之后，需要隐式开启一条协程，用于接收服务器推送过来的消息（即当用户好友给用户发消息时，会有消息提示）**


#######用户注册功能实现#
按照类似用户登录功能的步骤
注：用户注册是向服务器发送一个结构体类型的数据，序列化时候json标签需要对应


#######显示当前在线用户列表功能实现#
用户登录后，可以得到当前在线用户列表
1.在服务器维护一个onlineUsers map[int]*UserProcess
2.创建一个新的文件userMgr.go,完成功能对onlineUsers 这个map的增删改查
3.在LoginResMess 增加一个字段User []int,将在线用户id返回
4.当用户登录后，可以显示当前在线用户列表

关键点：当一个新的用户上线，其他用户界面中的在线用户列表会更新
解决方案
1.当有一个用户上线之后，服务器就马上把维护的onlineUsersMap整体推送
2.服务器使用自己的策略，每隔一段时间把维护的onlineUsersMap整体推送
3.
3.1.当一个用户上线后，服务器就把A的上线信息就推送给所有在线用户
3.2.客户端也需要维护一个map，map记录了他的好友（目前是所有人）map[int]User
3.3.客户端和服务器的通讯通道要依赖于serverProcessMes协程，该协程在登录成功之后就会隐式启动

**注：功能还存在缺陷，1.显示的是所有人的在线情况，并非好友在线情况，待完善
                      2.只能更新上线情况，下线情况待更新（设置状态值，当与服务器断开连接的时候，服务器向其他在线用户发送更新信息）**


离线部分实现
1.用户选择退出系统会向系统发送离线信息
2.服务器向其余在线用户转发信息
3.删除onlineUsers中离线的用户，并更新在线列表

如果是ctrl + c怎么判断?

#######客户端群聊发送功能实现#
思路
1.新增一个消息结构体SmMes
2.新增一个model CurUser
3.在smsProcess.go增加相应的方法，SendGroupMes
4.服务器接收到SmsMes消息
5.服务器端增加群发消息的功能
6.在客户端增加去处理服务器端转发的群发消息


实现步骤
1.当一个用户上线后，可以将群聊消息发给服务器，服务器可以接收到
2.服务器端遍历在线用户map
3.向在线用户进行消息转发


**注：群聊信息中，如果使用scan读取带空格的字符串时，会出现读取不到的情况，scan是读取到空格为止**
**因此使用bufio.NewReader().ReadString("\n\r")**


#######客户端私聊发送功能实现#
私聊功能
思路：
1.用户成功登录之后，选择私聊
2.显示当前用户在线列表
3.选择用户ID
4.向指定用户发出私聊信息
  4.1.私聊信息先发往服务器
  4.2.服务器接收到消息和指定用户
  4.3.将私聊信息转发给用户

需要定义一个新的信息结构体：区别于群聊功能，结构体中需要增加指定的接收者


#######待完善的功能#
1.好友添加
2.好友私聊和群聊（目前是只要是在线用户就能聊天）
3.离线留言



















